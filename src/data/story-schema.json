{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/bence-toth/adventure-book/main/src/data/story-schema.json",
  "title": "Adventure Book Story Format",
  "description": "YAML schema for Adventure Book interactive story files",
  "type": "object",
  "required": ["metadata", "intro", "passages"],
  "additionalProperties": false,
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Story metadata and information",
      "required": ["title", "author", "version"],
      "additionalProperties": false,
      "properties": {
        "title": {
          "type": "string",
          "minLength": 1,
          "description": "The title of your adventure story"
        },
        "author": {
          "type": "string",
          "minLength": 1,
          "description": "The author of the story"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
          "description": "Version number (e.g., 1.0 or 1.0.0)",
          "examples": ["1.0", "1.0.0", "2.1.3"]
        }
      }
    },
    "intro": {
      "type": "object",
      "description": "Introduction section displayed before starting the adventure",
      "required": ["text", "action"],
      "additionalProperties": false,
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "description": "Introduction text. Use YAML pipe (|) notation for multi-line text. Separate paragraphs with blank lines."
        },
        "action": {
          "type": "string",
          "minLength": 1,
          "description": "Text for the button that starts the adventure",
          "examples": ["Begin your adventure", "Start", "Enter the story"]
        }
      }
    },
    "passages": {
      "type": "object",
      "description": "Story passages indexed by positive integers (1, 2, 3, etc.)",
      "patternProperties": {
        "^[1-9]\\d*$": {
          "$ref": "#/$defs/passage"
        }
      },
      "additionalProperties": false,
      "minProperties": 1
    },
    "items": {
      "type": "array",
      "description": "Optional list of items that can be collected or removed during the story",
      "items": {
        "$ref": "#/$defs/inventoryItem"
      }
    }
  },
  "$defs": {
    "passage": {
      "type": "object",
      "description": "A single passage in your story",
      "required": ["text"],
      "additionalProperties": false,
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "description": "Passage content. Use YAML pipe (|) notation for multi-line text. Separate paragraphs with blank lines."
        },
        "choices": {
          "type": "array",
          "description": "Available choices for the reader. Omit this field for ending passages.",
          "items": {
            "$ref": "#/$defs/choice"
          },
          "minItems": 1
        },
        "ending": {
          "const": true,
          "description": "Mark this passage as an ending. Ending passages must not have choices."
        },
        "type": {
          "type": "string",
          "description": "Type of ending (only used with ending: true)",
          "enum": ["victory", "defeat", "neutral"]
        },
        "effects": {
          "type": "array",
          "description": "Optional effects that execute when this passage is reached",
          "items": {
            "$ref": "#/$defs/effect"
          }
        }
      },
      "allOf": [
        {
          "if": {
            "required": ["ending"]
          },
          "then": {
            "not": {
              "required": ["choices"]
            }
          },
          "else": {
            "required": ["choices"]
          }
        },
        {
          "if": {
            "required": ["type"]
          },
          "then": {
            "required": ["ending"]
          }
        },
        {
          "if": {
            "required": ["ending"]
          },
          "then": {
            "not": {
              "required": ["effects"]
            }
          }
        }
      ]
    },
    "choice": {
      "type": "object",
      "description": "A choice option for the reader",
      "required": ["text", "goto"],
      "additionalProperties": false,
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "description": "Text displayed for this choice option"
        },
        "goto": {
          "type": "integer",
          "minimum": 1,
          "description": "ID of the passage this choice leads to"
        }
      }
    },
    "inventoryItem": {
      "type": "object",
      "description": "An item that can be collected or removed during the story",
      "required": ["id", "name"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1,
          "description": "Unique identifier for the item (used in effects)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Display name shown to the player"
        }
      }
    },
    "effect": {
      "type": "object",
      "description": "An effect that executes when a passage is reached",
      "required": ["type", "item"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of effect to apply",
          "enum": ["add_item", "remove_item"]
        },
        "item": {
          "type": "string",
          "minLength": 1,
          "description": "ID of the inventory item to add or remove"
        }
      }
    }
  }
}
